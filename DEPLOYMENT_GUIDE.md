# 部署指南 - 代码复制功能

## 快速部署

### 1. 环境变量设置

在 Vercel Dashboard 中设置以下环境变量：

```
VITE_NOTION_API_KEY=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
VITE_NOTION_DATABASE_ID=22e64c0b-37ed-80d3-bf96-e7fcea7efa10
```

### 2. 本地测试

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 测试代码复制功能
open http://localhost:3000/test-code-copy.html
```

### 3. 生产环境测试

```bash
# 使用 Vercel CLI 本地模拟生产环境
npm run vercel:dev

# 或者构建并预览
npm run build
npm run preview
```

## 功能验证清单

### ✅ 基础功能
- [ ] 博客列表正常加载
- [ ] 博客详情页面正常打开
- [ ] 代码块正常显示
- [ ] 复制按钮出现在代码块右上角

### ✅ 复制功能
- [ ] 点击复制按钮能成功复制代码
- [ ] Bash 命令自动清理 `$` 提示符
- [ ] 复制成功后显示确认状态
- [ ] 复制失败时显示错误提示

### ✅ 样式和交互
- [ ] 复制按钮悬停效果正常
- [ ] Bash 命令使用青色主题
- [ ] 其他代码使用默认主题
- [ ] 响应式设计在移动端正常

### ✅ 兼容性
- [ ] Chrome/Edge 浏览器正常工作
- [ ] Firefox 浏览器正常工作
- [ ] Safari 浏览器正常工作
- [ ] HTTPS 环境下剪贴板 API 正常

## 测试用例

### 测试1: Bash 命令复制
1. 打开任意包含 bash 代码的博客文章
2. 找到 `language-bash` 的代码块
3. 点击复制按钮
4. 粘贴到文本编辑器
5. 验证 `$` 提示符已被移除

### 测试2: JavaScript 代码复制
1. 找到 JavaScript 代码块
2. 点击复制按钮
3. 验证代码格式保持不变

### 测试3: 动态内容
1. 搜索或切换博客文章
2. 验证新加载的代码块也有复制按钮
3. 测试复制功能正常

## 故障排除

### 问题1: 复制按钮不显示
**可能原因**: JavaScript 模块加载失败
**解决方案**: 
```bash
# 检查浏览器控制台错误
# 确认文件路径正确
# 验证模块导入语法
```

### 问题2: 复制功能不工作
**可能原因**: 剪贴板 API 权限问题
**解决方案**:
- 确保在 HTTPS 环境下测试
- 检查浏览器权限设置
- 验证 `navigator.clipboard` 可用性

### 问题3: 样式显示异常
**可能原因**: CSS 冲突或加载顺序问题
**解决方案**:
- 检查 CSS 文件加载顺序
- 验证样式优先级
- 清除浏览器缓存

## 性能优化

### 1. 懒加载
代码复制功能使用 MutationObserver 监听 DOM 变化，只在需要时初始化。

### 2. 内存管理
避免重复添加复制按钮，自动检测已处理的代码块。

### 3. 事件委托
使用事件委托减少事件监听器数量。

## 监控和分析

### 关键指标
- 复制按钮点击率
- 复制成功率
- 用户停留时间
- 代码块交互率

### 错误监控
```javascript
// 在生产环境中添加错误监控
window.addEventListener('error', (event) => {
  if (event.filename.includes('codeBlockCopy')) {
    // 发送错误报告
    console.error('代码复制功能错误:', event.error);
  }
});
```

## 后续优化计划

### v1.1.0 计划功能
- [ ] 支持多行选择复制
- [ ] 添加复制历史记录
- [ ] 支持代码语法高亮
- [ ] 添加复制统计分析

### v1.2.0 计划功能
- [ ] 支持代码块折叠/展开
- [ ] 添加代码执行功能（沙盒环境）
- [ ] 支持代码分享功能
- [ ] 集成代码编辑器

## 联系和支持

如果在部署过程中遇到问题，请：

1. 检查浏览器控制台错误信息
2. 验证环境变量配置
3. 测试网络连接和 API 访问
4. 查看项目 README 和文档

---

**部署完成后，请访问博客页面验证所有功能正常工作！** 🚀