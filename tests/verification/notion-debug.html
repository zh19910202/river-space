<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion API è°ƒè¯•å·¥å…·</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: monospace; padding: 20px; }
        .section { background: rgba(255,255,255,0.05); border: 1px solid #00ffff; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .title { color: #00ffff; font-size: 18px; margin-bottom: 15px; }
        .button { background: linear-gradient(45deg, #00ffff, #0080ff); color: #000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        .input { width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid #333; border-radius: 4px; color: white; margin: 5px 0; }
        .output { background: rgba(0,0,0,0.5); border: 1px solid #333; border-radius: 4px; padding: 15px; margin: 15px 0; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: rgba(0,255,0,0.1); border: 1px solid rgba(0,255,0,0.3); color: #00ff00; }
        .error { background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3); color: #ff6b6b; }
        .info { background: rgba(0,255,255,0.1); border: 1px solid rgba(0,255,255,0.3); color: #00ffff; }
    </style>
</head>
<body>
    <h1 style="color: #00ffff; text-align: center;">ğŸ”§ Notion API è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <div class="title">1. é…ç½®æµ‹è¯•</div>
        <input type="password" id="apiKey" class="input" placeholder="Notion API Key">
        <input type="text" id="databaseId" class="input" placeholder="Database ID">
        <button class="button" onclick="testConfig()">æµ‹è¯•é…ç½®</button>
        <button class="button" onclick="loadConfig()">åŠ è½½é…ç½®</button>
        <div id="configStatus" class="status info">è¯·è¾“å…¥é…ç½®ä¿¡æ¯</div>
    </div>
    
    <div class="section">
        <div class="title">2. è¿æ¥æµ‹è¯•</div>
        <button class="button" onclick="testConnection()">æµ‹è¯•APIè¿æ¥</button>
        <button class="button" onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“</button>
        <button class="button" onclick="testSimpleQuery()">ç®€å•æŸ¥è¯¢</button>
        <div id="connectionStatus" class="status info">ç‚¹å‡»æµ‹è¯•è¿æ¥</div>
        <div id="connectionOutput" class="output" style="display: none;"></div>
    </div>
    
    <div class="section">
        <div class="title">3. ä¿®å¤å»ºè®®</div>
        <div style="color: #ccc; font-size: 14px;">
            <p><strong>å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
            <ul>
                <li><strong>body.filteré”™è¯¯ï¼š</strong> æ£€æŸ¥è¿‡æ»¤å™¨æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨</li>
                <li><strong>unauthorizedï¼š</strong> æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®</li>
                <li><strong>not_foundï¼š</strong> æ£€æŸ¥Database IDæ˜¯å¦æ­£ç¡®</li>
                <li><strong>validation_errorï¼š</strong> æ£€æŸ¥æ•°æ®åº“å­—æ®µç»“æ„</li>
            </ul>
        </div>
    </div>

    <script>
        let config = { apiKey: '', databaseId: '' };
        
        function updateStatus(id, msg, type) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.className = `status ${type}`;
        }
        
        function updateOutput(id, content) {
            const el = document.getElementById(id);
            el.textContent = content;
            el.style.display = 'block';
        }
        
        function loadConfig() {
            try {
                const stored = localStorage.getItem('notion_config');
                if (stored) {
                    const data = JSON.parse(stored);
                    document.getElementById('apiKey').value = data.apiKey || '';
                    document.getElementById('databaseId').value = data.databaseId || '';
                    updateStatus('configStatus', 'âœ… é…ç½®å·²åŠ è½½', 'success');
                } else {
                    updateStatus('configStatus', 'âš ï¸ æœªæ‰¾åˆ°å­˜å‚¨çš„é…ç½®', 'error');
                }
            } catch (e) {
                updateStatus('configStatus', 'âŒ åŠ è½½å¤±è´¥: ' + e.message, 'error');
            }
        }
        
        function testConfig() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const databaseId = document.getElementById('databaseId').value.trim();
            
            if (!apiKey || !databaseId) {
                updateStatus('configStatus', 'âŒ è¯·å¡«å†™å®Œæ•´é…ç½®', 'error');
                return;
            }
            
            config = { apiKey, databaseId };
            updateStatus('configStatus', 'âœ… é…ç½®å·²è®¾ç½®', 'success');
        }
        
        async function testConnection() {
            if (!config.apiKey) {
                updateStatus('connectionStatus', 'âŒ è¯·å…ˆè®¾ç½®é…ç½®', 'error');
                return;
            }
            
            updateStatus('connectionStatus', 'ğŸ”„ æµ‹è¯•è¿æ¥ä¸­...', 'info');
            
            try {
                const response = await fetch('https://api.notion.com/v1/users/me', {
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Notion-Version': '2022-06-28'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus('connectionStatus', 'âœ… APIè¿æ¥æˆåŠŸ', 'success');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                } else {
                    updateStatus('connectionStatus', 'âŒ APIè¿æ¥å¤±è´¥', 'error');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                updateStatus('connectionStatus', 'âŒ è¿æ¥é”™è¯¯: ' + error.message, 'error');
                updateOutput('connectionOutput', error.stack);
            }
        }
        
        async function testDatabase() {
            if (!config.apiKey || !config.databaseId) {
                updateStatus('connectionStatus', 'âŒ è¯·å…ˆè®¾ç½®é…ç½®', 'error');
                return;
            }
            
            updateStatus('connectionStatus', 'ğŸ”„ æµ‹è¯•æ•°æ®åº“è®¿é—®...', 'info');
            
            try {
                const response = await fetch(`https://api.notion.com/v1/databases/${config.databaseId}`, {
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Notion-Version': '2022-06-28'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus('connectionStatus', 'âœ… æ•°æ®åº“è®¿é—®æˆåŠŸ', 'success');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                } else {
                    updateStatus('connectionStatus', 'âŒ æ•°æ®åº“è®¿é—®å¤±è´¥', 'error');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                updateStatus('connectionStatus', 'âŒ æ•°æ®åº“é”™è¯¯: ' + error.message, 'error');
                updateOutput('connectionOutput', error.stack);
            }
        }
        
        async function testSimpleQuery() {
            if (!config.apiKey || !config.databaseId) {
                updateStatus('connectionStatus', 'âŒ è¯·å…ˆè®¾ç½®é…ç½®', 'error');
                return;
            }
            
            updateStatus('connectionStatus', 'ğŸ”„ æµ‹è¯•ç®€å•æŸ¥è¯¢...', 'info');
            
            try {
                const requestBody = { page_size: 3 };
                
                const response = await fetch(`https://api.notion.com/v1/databases/${config.databaseId}/query`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Notion-Version': '2022-06-28',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus('connectionStatus', `âœ… æŸ¥è¯¢æˆåŠŸï¼Œæ‰¾åˆ° ${data.results.length} æ¡è®°å½•`, 'success');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                } else {
                    updateStatus('connectionStatus', 'âŒ æŸ¥è¯¢å¤±è´¥', 'error');
                    updateOutput('connectionOutput', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                updateStatus('connectionStatus', 'âŒ æŸ¥è¯¢é”™è¯¯: ' + error.message, 'error');
                updateOutput('connectionOutput', error.stack);
            }
        }
        
        // è‡ªåŠ¨åŠ è½½é…ç½®
        document.addEventListener('DOMContentLoaded', loadConfig);
    </script>
</body>
</html>